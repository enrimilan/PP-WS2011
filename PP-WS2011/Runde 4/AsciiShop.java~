import java.util.Scanner;
public class AsciiShop {
	public static void main (String [] args){
		
		Scanner sc = new Scanner(System.in);
		int tempHeight = 0;//Variable die verwendet wird um die Zeilen zu zählen.
		int height=0;
		boolean ok = true ;//Variable die prüft ob ein Fehler passiert ist.
		
		//Einlesen und Prüfen des read Befehls.
		String befehl = sc.next();
		if(befehl.equals("read")){
			if(sc.hasNextInt()){
				height = sc.nextInt();
			}
			else {
				ok=false ;
				System.out.println("INPUT MISMATCH");
				
			}
		}
		else {
			ok = false ;
			System.out.println("INPUT MISMATCH");
		}
		
		
		
		
		
		
		//Erstellen des AsciiImage Objekts.
		AsciiImage image = new AsciiImage ();
		
		if(ok==true){
			
			String read ="";//Hier wird jede Zeile gespeichert.
			while(sc.hasNext()){
				
				read = sc.next();
				if(!read.equals("fill")&&!read.equals("uniqueChars")&&!read.equals("flip-v")&&!read.equals("transpose")&&!read.equals("symmetric-h")){
					if(image.addLine(read)==true)
					{
						tempHeight=image.getHeight();
						
					}
					else{
						System.out.println("INPUT MISMATCH");
						ok=false ;
						break ;
					}
					
					if(tempHeight>height){
						System.out.println("INPUT MISMATCH");
						ok=false ;
						break;
					}
					
					
				}
				
				else if(read.equals("uniqueChars")){
					//Prüfen der Höhe des Bildes.
					if(tempHeight!=height){
						ok = false ;
						System.out.println("INPUT MISMATCH");
						break ;
					}
					System.out.println(image.getUniqueChars());
				}
				else if(read.equals("flip-v")){
					//Prüfen der Höhe des Bildes.
					if(tempHeight!=height){
						ok = false ;
						System.out.println("INPUT MISMATCH");
						break ;
					}
					image.flipV();
				}
				else if(read.equals("transpose")){
					//Prüfen der Höhe des Bildes.
					if(tempHeight!=height){
						ok = false ;
						System.out.println("INPUT MISMATCH");
						break ;
					}
					image.transpose();
				}
				else if(read.equals("symmetric-h")){
					//Prüfen der Höhe des Bildes.
					if(tempHeight!=height){
						ok = false ;
						System.out.println("INPUT MISMATCH");
						break ;
					}
					System.out.println(image.isSymmetricH());
				}
				
				//Falls der Befehl fill auftritt.
				else if(read.equals("fill")) {
					//Prüfen der Höhe des Bildes.
					if(tempHeight!=height){
						ok = false ;
						System.out.println("INPUT MISMATCH");
						break ;
					}
					
					
					
					//Prüfen ob alle Parameter vorhanden sind , und der angegebenen Position von fill.
					if(sc.hasNextInt()){
						
						int x = sc.nextInt();
						if(sc.hasNextInt()){
							int y = sc.nextInt();
							if(sc.hasNext()){
								char c = sc.next().charAt(0);
								if(x>=image.getWidth()||y>=image.getHeight()){
									System.out.println("OPERATION FAILED");
									ok=false ;
									break ;
								}
								else {
									image.fill(x,y,c);
								}
							}
							else {
								ok = false ;
								System.out.println("INPUT MISMATCH");
								break ;
							}
						}
						else {
							ok = false ;
							System.out.println("INPUT MISMATCH");
							break ;
						}
						
					}
					else{
						ok = false ;
						System.out.println("INPUT MISMATCH");
						break ;
					}
					
				}
				
			}
			
			
		}
		//Speichern des Bildes in die Variable "bild" Zeile für Zeile und dann wird es ausgegeben.
		if(ok==true){
			
			System.out.println(image.toString());
			System.out.println(image.getWidth()+" "+image.getHeight());
		}
		
		
	}
	
	
}
